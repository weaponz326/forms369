<div class="container-scroller">
  <app-navigation-bar></app-navigation-bar>
  <div class="container-fluid page-body-wrapper">
    <app-side-bar></app-side-bar>
    <div class="main-panel">
      <div class="content-wrapper">

        <div class="row top">
          <div class="col-md-12 grid-margin">
            <div class="d-flex justify-content-between flex-wrap">
              <div class="d-flex align-items-end flex-wrap">
                <div class="mr-md-3 mr-xl-5">
                  <h2>Setup a new form</h2>
                  <p class="mb-md-0">Design a new form here, just drag  and drop the elements or click to add.</p>
                </div>
                <div class="d-flex">
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-end flex-wrap">
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="_loading" class="row">
          <div class="col-md-12">
            <div class="d-flex justify-content-center pb-5 pt-5">
              <div class="spinner-border mt-5" style="width: 6rem; height: 6rem;" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
        </div>

        <div [hidden]="_loading || created" class="row">
          <div class="col-md-12 grid-margin stretch-card">
            <div class="card" style="height: 750px; overflow: scroll;">
              <div class="card-body">
                <p class="card-title">Create New Form</p>
                <p class="text-muted">
                  Drag and drop the form elements on your the right onto the panel on the left to create your form.
                  You can re-arrange the order of the elements you drag onto the left panel by dragging the form
                  elements to your desired position. You can also click on an element to add it to your form.
                </p>

                <form [formGroup]="form">
                  <div class="row mt-4">
                    <div class="col-4">
                      <div class="form-group">
                        <input type="text" formControlName="name" class="form-control" placeholder="Whats the name of your form ?"
                          [ngClass]="{'input-control-error': submitted && f.name.errors}">
                        <div *ngIf="submitted && f.name.errors">
                          <p class="input-error" *ngIf="f.name.errors.required">Form name is required</p>
                        </div>
                      </div>
                    </div>
                    <div [ngClass]="{'col-3': showFileUpload, 'col-4': !showFileUpload}">
                      <div class="form-group">
                        <select class="form-control" formControlName="merchant" (change)="onMerchantSelect($event)"
                          [ngClass]="{'input-control-error': submitted && f.merchant.errors}">
                          <option value="" disabled>Select Company</option>
                          <option *ngFor="let company of allMerchantsList" [value]="company.id">
                            {{ company.merchant_name }}
                          </option>
                        </select>
                        <div *ngIf="submitted && f.merchant.errors">
                          <p class="input-error" *ngIf="f.merchant.errors.required">Company is required</p>
                        </div>
                      </div>
                    </div>
                    <div [ngClass]="{'col-2': showFileUpload, 'col-4': !showFileUpload}">
                      <div class="form-group">
                        <select class="form-control" formControlName="canView" [ngClass]="{'input-control-error': submitted && f.canView.errors}">
                          <option value="" disabled>Can View</option>
                          <option value="0">No</option>
                          <option value="1">Yes</option>
                        </select>
                      </div>
                    </div>
                    <div *ngIf="showFileUpload" class="col-3">
                      <div class="form-group">
                        <input #pdfFile type="file" accept="application/pdf" (change)="inputFileChanged($event)" class="file-upload-default">
                        <div class="input-group col-xs-12">
                          <input type="file" style="overflow: hidden; height: 0px; width: 0px;">
                          <input type="text" formControlName="pdf" class="form-control file-upload-info" placeholder="Upload File" readonly>
                          <span class="input-group-append">
                            <button class="file-upload-browse btn btn-primary" type="button" (click)="showFilePicker()">Upload PDF</button>
                          </span>
                        </div>
                        <div *ngIf="submitted && f.pdf.errors">
                          <p class="input-error" *ngIf="f.pdf.errors.required">PDF file is required</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-builder-container">
                    <div id="fb-editor"></div>
                  </div>

                  <button type="submit" *ngIf="!loading" class="btn btn-primary mt-2 mr-1" (click)="create()">Create</button>
                  <button type="submit" *ngIf="!loading && !showFileUpload" class="btn btn-primary mt-2 mr-1" (click)="publish()">Create & Publish</button>
                  <button type="button" *ngIf="loading" class="btn btn-primary mr-2" disabled>
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp; &nbsp;
                    Please wait...
                  </button>
                  <button type="button" *ngIf="!loading" class="btn btn-primary mt-2 mr-1" (click)="reset()">Reset</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="created" class="row">
          <div class="col-md-12 grid-margin">
            <div class="card pt-5 pb-5 text-center">
              <div class="card-body">
                <p class="card-title">Success</p>
                <p class="text-muted"></p>
                <div class="card-text">
                  <i class="mdi mdi-shield-check-outline text-primary" style="font-size: 12em;"></i>
                  <h2>1 Form Created</h2>
                  <h4>{{ formName }} Form has been created </h4>
                  <p class="text-muted">You have succesfully created a form</p>
                </div>
                <div class="card-text mt-4">
                  <button type="button" class="btn btn-primary btn-lg btn-icon-text mr-2" (click)="bringBackForm()">
                    <i class="mdi mdi-plus"></i>
                    Create New
                  </button>
                  <button type="button" class="btn btn-primary btn-lg btn-icon-text mr-2" (click)="preview()">
                    <i class="mdi mdi-eye"></i>
                    Preview
                  </button>
                  <button type="button" class="btn btn-dark btn-lg btn-icon-text mr-2" (click)="ok()">
                    <i class="mdi mdi-check"></i>
                    Ok
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="uploadError" class="row">
          <div class="col-md-12 grid-margin">
            <div class="card pt-5 pb-5 text-center">
              <div class="card-body">
                <p class="card-title">Failed</p>
                <p class="text-muted"></p>
                <div class="card-text">
                  <i class="mdi mdi-cloud-off-outline text-secondary" style="font-size: 10em;"></i>
                  <h2>File Upload Failed</h2>
                  <p class="text-muted">
                    Ooops! An error occured uploading your PDF. Please check to make sure the file is not corrupted.
                    Also check if you have a stable internet connection or our server may be down.
                  </p>
                </div>
                <div class="card-text mt-4">
                  <button type="button" class="btn btn-primary btn-lg btn-icon-text mr-2" (click)="ok1()">
                    Ok
                  </button>
                  <button type="button" class="btn btn-primary btn-lg btn-icon-text mr-2" (click)="retry()">
                    Retry
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #badtype let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Bad File Format ?</h4>
    <button type="button" class="close" aria-describedby="modal-title" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p><strong>Wrong file type selected!.</strong></p>
    <p>Please make sure the file you selected has a file extension of .pdf or the file is a valid PDF file.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.close()">Ok, Got It</button>
  </div>
</ng-template>